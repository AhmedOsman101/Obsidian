<!DOCTYPE html>
<html>
	<head>
		<title>
			Mastering Laravel 10 Query Builder, Eloquent and Relationships
		</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="main.css" />

		<script type="text/javascript">
			window.MathJax = {
				tex: {
					inlineMath: [
						["$", "$"],
						["\\(", "\\)"],
					],
					displayMath: [
						["$$", "$$"],
						["\\[", "\\]"],
					],
				},
				options: {},
				loader: {},
			};
		</script>
		<script
			type="text/javascript"
			async=""
			src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
			charset="UTF-8"></script>
	</head>
	<body for="html-export">
		<div class="crossnote markdown-preview">
			<h1
				id="mastering-laravel-10-query-builder-eloquent-and-relationships">
				Mastering Laravel 10 Query Builder, Eloquent and Relationships
			</h1>
			<h2 id="migrations">Migrations:</h2>
			<h3 id="column-modifiers">Column modifiers:</h3>
			<pre
				class="text language-text language-php php"
				data-role="codeBlock"
				data-info="php"><code><span class="token variable">$col</span> <span class="token operator">=</span> <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token keyword type-declaration keyword-string">string</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$col</span><span class="token operator">-&gt;</span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// unique column that can't have duplicates</span>

<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// define multiple unique columns at once</span>

<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token argument-name">startingValue</span><span class="token punctuation">:</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// changes the starting value of the autoincrement property.</span>
<span class="token comment">// Equivalent to `ALTER TABLE tableName AUTO_INCREMENT = 5000;`</span>

<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">bigIncrements</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'user_id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Custom primary key</span>

<span class="token comment">// creating a foreign key manually:</span>
<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">unsignedBigInteger</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'post_id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// datatype for the foreign key</span>
<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">foreign</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'post_id'</span><span class="token punctuation">)</span> <span class="token comment">// creates a foreign key `post_id`</span>
      <span class="token operator">-&gt;</span><span class="token function">references</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'posts'</span><span class="token punctuation">)</span> <span class="token comment">// refers to posts.id</span>
      <span class="token operator">-&gt;</span><span class="token function">cascadeOnDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// If a record in the parent table is deleted, all related records in the child table will also be automatically deleted.</span>

<span class="token comment">// creating a foreign key (modern way):</span>
<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">foreignId</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'post_id'</span><span class="token punctuation">,</span> <span class="token argument-name">model</span><span class="token punctuation">:</span> <span class="token scope">Post<span class="token punctuation">::</span></span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span>
<span class="token comment">// model is optional (automatically inferred but provide it when having weird names).</span>
<span class="token comment">// or</span>
<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">foreignId</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'post_id'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">constrained</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'posts'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Constrained by default sets up an `ON DELETE CASCADE` constraint.</span>

<span class="token variable">$col</span><span class="token operator">-&gt;</span><span class="token function">comment</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// adds a comment to your columns (visible on the database view software)</span>

<span class="token variable">$col</span><span class="token operator">-&gt;</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'any value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// adds a default value to the column</span>

<span class="token variable">$col</span><span class="token operator">-&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// change order in the database</span>

<span class="token variable">$col</span><span class="token operator">-&gt;</span><span class="token function">nullable</span><span class="token punctuation">(</span><span class="token keyword keyword-default">default</span><span class="token punctuation">:</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// declares a column as nullable (accept null values)</span></code></pre>
			<p>
				<code>art migrate:status</code> =&gt; Show the status of each
				migration.
			</p>
			<p>
				<code>art migrate:status --database[=DATABASE]</code> =&gt; The
				database connection to use.
			</p>
			<p>
				<code>art migrate:status --pending</code> =&gt; Only list
				pending migrations.
			</p>
			<p>
				<code>art migrate --pretend</code> =&gt; Dump the SQL queries
				that <strong>would be run</strong>, it
				<strong>doesn’t actually run</strong>.
			</p>
			<p>
				<code>art migrate --force</code> =&gt; Force the operation to
				run when in production, all data is lost.
			</p>
			<p>
				<code>art migrate:reset</code> =&gt; Rollback all database
				migrations.
			</p>
			<p>
				<code>art migrate:rollback</code> =&gt; Rollback the last
				database migration.
			</p>
			<p>
				<code>art migrate:rollback --step[=STEP]</code> =&gt; The number
				of migrations to be reverted.
			</p>
			<p>
				<code>art migrate:fresh</code> =&gt;
				<strong>Drop all tables</strong> and re-run all migrations.
			</p>
			<p>
				<code>art migrate:refresh</code> =&gt;
				<strong>Reset</strong> (runs the <code>down()</code> method of
				the migration) and re-run all migrations.
			</p>
			<p>
				<code>art migrate:refresh --step[=STEP]</code> =&gt; The number
				of migrations to be reverted &amp; re-run.
			</p>
			<p>
				<code>art schema:dump</code> =&gt; Dump the given database
				schema (exports it to raw SQL).
			</p>
			<p>
				<code>art schema:dump --prune</code> =&gt; Delete all existing
				migration files and replace them with the SQL file.
			</p>
			<p>
				<code>art make:migration</code> =&gt; Create a new migration
				file.
			</p>
			<p>
				<code>art make:migration --create[=CREATE]</code> =&gt; The
				table to be created.
			</p>
			<p>
				<code>art make:migration --table[=TABLE]</code> =&gt; The table
				to migrate.
			</p>
			<p><strong>Migration naming conventions:</strong></p>
			<ul>
				<li>adding a column: <code>add_email_in_users_table</code>.</li>
				<li>
					rename a column:
					<code>rename_name_to_username_on_users_table</code>.
				</li>
				<li>
					dropping a column: <code>drop_email_from_users_table</code>.
				</li>
				<li>adding a column: <code>add_email_in_users_table</code>.</li>
			</ul>
			<pre
				class="text language-text language-php php"
				data-role="codeBlock"
				data-info="php"><code><span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">softDeletes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Adds `deleted_at` timestamp.</span>
<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">renameColumn</span><span class="token punctuation">(</span><span class="token argument-name">oldname</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token argument-name">newname</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'fullName'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Renames columns</span>
<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">dropColumn</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'col1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Drop one column</span>
<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">dropColumn</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'votes'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'avatar'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'location'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Drop multiple columns by passing an array of column names.</span>
<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">dropSoftDeletes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Drop the `deleted_at` column.</span>
<span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">dropTimestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Drop the `created_at` and `updated_at` columns.</span></code></pre>
			<p>
				<strong>Note:</strong> Utilize seeders for crucial and necessary
				data, whereas factories should be used for generating fake data
				for testing purposes.
			</p>
			<hr />
			<h2 id="factories--seeders">Factories &amp; Seeders:</h2>
			<pre
				class="text language-text language-php php"
				data-role="codeBlock"
				data-info="php"><code><span class="token comment">// inside DatabaseSeeder.php</span>
<span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token scope">Seeder<span class="token punctuation">::</span></span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// run single seeder</span>

<span class="token this keyword">$this</span><span class="token operator">-&gt;</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token scope">UserSeeder<span class="token punctuation">::</span></span><span class="token keyword keyword-class">class</span><span class="token punctuation">,</span>
    <span class="token scope">PostSeeder<span class="token punctuation">::</span></span><span class="token keyword keyword-class">class</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// run multiple seeders.</span></code></pre>
			<p><strong>Reading data from JSON files:</strong></p>
			<pre
				class="text language-text language-php php"
				data-role="codeBlock"
				data-info="php"><code><span class="token comment">// 1. Create a JSON file in `database\json` and name it after the table name e.g. `users.json`.</span>

<span class="token comment">// 2. Read the file content:</span>
<span class="token variable">$json</span> <span class="token operator">=</span> <span class="token scope">File<span class="token punctuation">::</span></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'database/json/users.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns the json text</span>

<span class="token comment">// 3. convert it, there is two ways:</span>
<span class="token comment">// First way:</span>
<span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">,</span> <span class="token argument-name">associative</span><span class="token punctuation">:</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns an associative array with the content of the file</span>

<span class="token comment">// Second way:</span>
<span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// convert to collection</span>

<span class="token comment">// 4. Insert the data:</span>
<span class="token comment">// First way:</span>
<span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token variable">$data</span> <span class="token keyword keyword-as">as</span> <span class="token variable">$item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// loop over the assoc array</span>
    <span class="token scope">User<span class="token punctuation">::</span></span><span class="token function">create</span><span class="token punctuation">(</span><span class="token variable">$item</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Second way:</span>
<span class="token variable">$data</span><span class="token operator">-&gt;</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token variable">$item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// loop over the collection with the callback</span>
    <span class="token scope">User<span class="token punctuation">::</span></span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token string double-quoted-string">"name"</span> <span class="token operator">=&gt;</span> <span class="token variable">$item</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">"email"</span> <span class="token operator">=&gt;</span> <span class="token variable">$item</span><span class="token operator">-&gt;</span><span class="token property">email</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">"password"</span> <span class="token operator">=&gt;</span> <span class="token variable">$item</span><span class="token operator">-&gt;</span><span class="token property">password</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
			<hr />
			<h2 id="query-builder">Query Builder:</h2>
			<p>
				<code>art db:table [&lt;table&gt;]</code> =&gt; Display
				information about the given database table.
			</p>
			<p>Example: <img src="../code1.png" /></p>
			<h3 id="reading-data">Reading Data:</h3>
			<pre
				class="text language-text language-php php"
				data-role="codeBlock"
				data-info="php"><code><span class="token variable">$t</span> <span class="token operator">=</span> <span class="token scope">DB<span class="token punctuation">::</span></span><span class="token function">table</span><span class="token punctuation">(</span><span class="token argument-name">table</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Specify the table you are working on</span>

<span class="token variable">$q1</span> <span class="token operator">=</span> <span class="token variable">$t</span><span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token argument-name">columns</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"email"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Specify which columns to retrieve default is ["*"] (all columns).</span>

<span class="token variable">$q1</span> <span class="token operator">=</span> <span class="token variable">$t</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Get the result as an array of rows</span>

<span class="token variable">$t</span><span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name as username'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Changes the output name of the column.</span>

<span class="token variable">$t</span><span class="token operator">-&gt;</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Force the query to only return distinct results.</span>
<span class="token comment">// if a value is repeated more than once, it will take only the first row</span>
<span class="token comment">// that contains it.</span>

<span class="token variable">$q2</span> <span class="token operator">=</span> <span class="token variable">$t</span><span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$q2</span><span class="token operator">-&gt;</span><span class="token function">addSelect</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Adds more columns to your SELECT clause of a query. You MUST add the `get()`</span>
<span class="token comment">// method to the last statement.</span>

<span class="token variable">$q3</span> <span class="token operator">=</span> <span class="token variable">$t</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token argument-name">column</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">"id"</span><span class="token punctuation">,</span> <span class="token argument-name">value</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// where`id` = 2;</span>
<span class="token comment">// This will select the user of id `1` only.</span>

<span class="token variable">$q3</span><span class="token operator">-&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Get the first column that matches this clause. Returns an object not an array.</span>

<span class="token variable">$q3</span><span class="token operator">-&gt;</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token argument-name">column</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Returns a single value from the query.</span>
<span class="token comment">// Useful when you only need one value from a record.</span>

<span class="token variable">$q4</span> <span class="token operator">=</span> <span class="token variable">$t</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token argument-name">id</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// searches for a record by its primary key (id). returns an Object.</span></code></pre>
			<p>
				The <code>pluck()</code> method is used to retrieve a single
				column’s value from the first result of a query. It takes two
				arguments the first is the <code>column</code> that you want to
				pluck the second an optional <code>key</code> to the values.
				Returns an array.
			</p>
			<p><code>pluck('name')</code> method output:</p>
			<p><img src="../code2.png" /></p>
			<p><code>pluck('email', 'name')</code> method output:</p>
			<p><img src="../code3.png" /></p>
			<h2 id="creating-data">Creating Data:</h2>
			<pre
				class="text language-text language-php php"
				data-role="codeBlock"
				data-info="php"><code><span class="token variable">$t</span> <span class="token operator">=</span> <span class="token scope">DB<span class="token punctuation">::</span></span><span class="token function">table</span><span class="token punctuation">(</span><span class="token argument-name">table</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Specify the table you are working on</span>
<span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string double-quoted-string">"name"</span>     <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"John Doe"</span><span class="token punctuation">,</span>
  <span class="token string double-quoted-string">"email"</span>    <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"JohnDoe@mail.com"</span><span class="token punctuation">,</span>
  <span class="token string double-quoted-string">"password"</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"password"</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token variable">$t</span><span class="token operator">-&gt;</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Inserts a new record, timestamps are null Returns true on success</span>

<span class="token variable">$t</span><span class="token operator">-&gt;</span><span class="token function">insertOrIgnore</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns 1 on success, returns 0 if existed.</span>
<span class="token comment">// Allows you to insert data into a database table only if the data doesn't already exist in the table.</span>

<span class="token variable">$values</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string single-quoted-string">'email'</span>   <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'john.doe@example.com'</span><span class="token punctuation">,</span>  
  <span class="token string single-quoted-string">'name'</span>    <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'John Doe updated'</span><span class="token punctuation">,</span>
  <span class="token string single-quoted-string">'revenue'</span> <span class="token operator">=&gt;</span> <span class="token number">1000</span><span class="token punctuation">,</span>  
<span class="token punctuation">]</span><span class="token punctuation">;</span>  
<span class="token variable">$uniqueBy</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'email'</span><span class="token punctuation">;</span>  
<span class="token variable">$update</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'revenue'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  
  
<span class="token variable">$t</span><span class="token operator">-&gt;</span><span class="token function">upsert</span><span class="token punctuation">(</span><span class="token variable">$values</span><span class="token punctuation">,</span> <span class="token variable">$uniqueBy</span><span class="token punctuation">,</span> <span class="token variable">$update</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// Insert new records or update the existing ones. Tries to insert first.</span>

<span class="token variable">$t</span><span class="token operator">-&gt;</span><span class="token function">insertGetId</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Insert new record and grab its id in a single query.</span></code></pre>
			<h2 id="updating-data">Updating Data:</h2>
			<pre
				class="text language-text language-php php"
				data-role="codeBlock"
				data-info="php"><code><span class="token variable">$t</span> <span class="token operator">=</span> <span class="token scope">DB<span class="token punctuation">::</span></span><span class="token function">table</span><span class="token punctuation">(</span><span class="token argument-name">table</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Specify the table you are working on</span>
<span class="token variable">$q</span> <span class="token operator">=</span> <span class="token scope">DB<span class="token punctuation">::</span></span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Spcific row to operate on.</span>

<span class="token comment">// Finds the user and updates its password field to `newPassword`.</span>
<span class="token variable">$q</span><span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"password"</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"newPassword"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// Returns the number of affected rows (int).</span>

<span class="token comment">// Insert or update a record matching the attributes, and fill it with values.</span>
<span class="token comment">// Tries to update first.</span>
<span class="token variable">$t</span><span class="token operator">-&gt;</span><span class="token function">updateOrInsert</span><span class="token punctuation">(</span>  
  <span class="token argument-name">attributes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'age'</span> <span class="token operator">=&gt;</span> <span class="token number">67</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  
  <span class="token argument-name">values</span>    <span class="token punctuation">:</span> <span class="token punctuation">[</span>  
    <span class="token string double-quoted-string">"name"</span>    <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"new user"</span><span class="token punctuation">,</span>  
    <span class="token string double-quoted-string">"email"</span>   <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">"newest@email.com"</span><span class="token punctuation">,</span>  
    <span class="token string double-quoted-string">"revenue"</span> <span class="token operator">=&gt;</span> <span class="token number">5000</span><span class="token punctuation">,</span>  
  <span class="token punctuation">]</span>  
<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Searches for a row with the given `attributes` (age of 67).</span>
<span class="token comment">// If it exists update it with the `values` array.</span>
<span class="token comment">// Else create a new row with the two arrays combined.</span></code></pre>
			<h2 id="deleting-data">Deleting Data:</h2>
			<pre
				class="text language-text language-php php"
				data-role="codeBlock"
				data-info="php"><code><span class="token variable">$t</span> <span class="token operator">=</span> <span class="token scope">DB<span class="token punctuation">::</span></span><span class="token function">table</span><span class="token punctuation">(</span><span class="token argument-name">table</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Specify the table you are working on</span>
<span class="token variable">$q</span> <span class="token operator">=</span> <span class="token scope">DB<span class="token punctuation">::</span></span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Spcific row to operate on.</span></code></pre>
			<h2 id="modifiers">Modifiers:</h2>
			<pre
				class="text language-text language-php php"
				data-role="codeBlock"
				data-info="php"><code><span class="token variable">$t</span> <span class="token operator">=</span> <span class="token scope">DB<span class="token punctuation">::</span></span><span class="token function">table</span><span class="token punctuation">(</span><span class="token argument-name">table</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Specify the table you are working on.</span>
<span class="token variable">$q</span> <span class="token operator">=</span> <span class="token scope">DB<span class="token punctuation">::</span></span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Spcific row to operate on.</span>

<span class="token variable">$t</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token argument-name">column</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">"id"</span><span class="token punctuation">,</span> <span class="token argument-name">value</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// where`id` = 2;</span>
<span class="token comment">// This will select the user of id `1` only.</span>

<span class="token variable">$t</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token argument-name">column</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'type'</span><span class="token punctuation">,</span> <span class="token argument-name">operator</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'!='</span><span class="token punctuation">,</span> <span class="token argument-name">value</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// The `where()` method takes three arguments: `column`, optional `operator` with default value of `==` and a value to compare against.</span>

<span class="token variable">$t</span><span class="token operator">-&gt;</span><span class="token function">orWhere</span><span class="token punctuation">(</span><span class="token argument-name">column</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'type'</span><span class="token punctuation">,</span> <span class="token argument-name">value</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Use `orWhere()` method to match multiple records at once. Order matters.</span>
<span class="token comment">// Always put where clause at the top of the query.</span>

<span class="token comment">// The increment() and decrement() methods are used to increment or decrement </span>
<span class="token comment">// the value of a column by a given amount, default 1.</span>
<span class="token variable">$t</span><span class="token operator">-&gt;</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token argument-name">column</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Increments the `age` column by one</span>
<span class="token variable">$t</span><span class="token operator">-&gt;</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token argument-name">column</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">'revenue'</span><span class="token punctuation">,</span> <span class="token argument-name">amount</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Decrements the `revenue` column by 1000.</span>

<span class="token variable">$q</span><span class="token operator">-&gt;</span><span class="token function">incrementEach</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'age'</span> <span class="token operator">=&gt;</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'revenue'</span> <span class="token operator">=&gt;</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Increment the given column's values by the given amounts.</span></code></pre>
			<hr />
			<h2 id="collections">Collections:</h2>
			<p>
				<code>Collection</code> class provides a fluent, convenient
				wrapper for working with arrays of data. the
				<code>Collection</code> class allows you to chain its methods to
				perform fluent mapping and reducing of the underlying array. In
				general, collections are immutable, meaning every
				<code>Collection</code> method returns an entirely new
				<code>Collection</code> instance.
			</p>
			<p>
				the <code>collect</code> helper to create a new collection
				instance from the given data:
			</p>
			<pre
				class="text language-text language-php php"
				data-role="codeBlock"
				data-info="php"><code><span class="token variable">$collection</span> <span class="token operator">=</span> <span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'taylor'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'abigail'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// creates a collection instance from the given value.</span></code></pre>
			<p>
				The <code>each</code> method iterates over the items in the
				collection and passes each item to a closure:
			</p>
			<pre
				class="text language-text language-php php"
				data-role="codeBlock"
				data-info="php"><code><span class="token variable">$collection</span> <span class="token operator">=</span> <span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token variable">$collection</span><span class="token operator">-&gt;</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token keyword type-hint keyword-int">int</span> <span class="token variable">$item</span><span class="token punctuation">,</span> <span class="token keyword type-hint keyword-int">int</span> <span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// actual functionality...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
			<hr />
			<h2 id="miscellaneous">Miscellaneous:</h2>
			<p>
				<code>art db:show</code> =&gt; Shows current database
				information.
			</p>
			<p>
				<code>art db:show --database=db_type</code> =&gt; Shows info
				about specific database, useful when having multiple db
				connections. db type can be MySQL, SQLite, etc.
			</p>
			<p>
				<code>art tinker</code> =&gt; Interact with your application,
				runs a REPL interface to do database operations.
			</p>
			<pre
				class="text language-text language-php php"
				data-role="codeBlock"
				data-info="php"><code><span class="token function">env</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'defaultValue'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Helper function that retrieves the value of an environment variable or returns a default value.</span>

<span class="token scope">Str<span class="token punctuation">::</span></span><span class="token function">slug</span><span class="token punctuation">(</span><span class="token keyword type-hint keyword-string">string</span> <span class="token variable">$title</span><span class="token punctuation">,</span> <span class="token keyword type-hint keyword-string">string</span> <span class="token variable">$separator</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Generate a URL friendly "slug" from a given string.</span>

<span class="token scope">User<span class="token punctuation">::</span></span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Doesn't add timestamps automatically.</span>
<span class="token scope">User<span class="token punctuation">::</span></span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Adds timestamps automatically .</span></code></pre>
		</div>
	</body>
</html>
